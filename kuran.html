<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kur'an Okuyucu</title>
<style>
@font-face {
    font-family: 'Aqeeq';
    src: url('/Aqeeq-Bold.ttf') format('truetype');
    font-weight: 700;
    font-style: normal;
    font-display: swap;
}
@font-face {
    font-family: 'StackSansNotch';
    src: url('/StackSansNotch-Bold.ttf') format('truetype');
    font-weight: 700;
    font-style: normal;
    font-display: swap;
}
@font-face {
    font-family: 'Alshohadaa';
    src: url('/alshohadaa.ttf') format('truetype');
    font-weight: 700;
    font-style: normal;
    font-display: swap;
}
body {
    margin: 0;
    font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Noto Sans', sans-serif;
    background: #fff;
    color: #000;
    line-height: 1.5;
}
html {
    overflow-x: hidden;
}
.content {
    max-width: 1000px;
    margin: auto;
    padding: 20px;
}
.arabic {
    font-family: 'Alshohadaa', serif;
    font-size: 72px;
    text-align: center;
    margin: 0;
}
h1 {
    font-family: 'StackSansNotch', sans-serif;
    font-size: 2rem;
    margin: 4px 0 20px;
    font-weight: 600;
    color: #444;
    text-align: center;
}
select, input { font-size: 16px; padding: 6px 12px; margin: 5px; }
.verse { margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.arabic-text {
    font-family: 'Aqeeq', 'Noto Naskh Arabic', serif;
    font-size: 32px;
    font-weight: 700;
    margin: 5px 0;
    text-align: right;
}
.english-text { font-size: 16px; margin-bottom: 10px; text-align: left; }
.verse-number { font-size: 12px; font-weight: bold; color: #555; margin-bottom: 5px; text-align: center; }
.loading { font-size: 18px; font-weight: bold; text-align: center; margin: 30px 0; }
mark { background-color: yellow; }

.nav-btn {
  font-family: 'StackSansNotch', sans-serif;
  font-size: 16px;
  font-weight: 600;
  color: #000;
  background: #fff;
  border: 1px solid #000;
  padding: 10px 16px;
  margin: 5px;
  border-radius: 999px;
  cursor: pointer;
  transition: all 0.2s ease;
}
.nav-btn:hover:not(:disabled) {
  background: #000;
  color: #fff;
}
.nav-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

@media(max-width:800px){
    .arabic-text{font-size:25px;}
    .english-text{font-size:14px;}
    .controls select,.controls input{font-size:14px;}
    .arabic{font-size:48px;}
    .nav-btn{font-size:14px; padding:8px 12px;}
}

/* Yazdƒ±rma Modu */
@media print {
    .controls,
    #navigationButtons,
    h1,
    .arabic {
        display: none !important;
    }
    body { margin: 20px; }
}
.topbar {
    width: 100%;
    color: #000;
    background: #fff;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    position: sticky;
    top: 0;
    left: 0;
    right: 0;
    z-index: 999;
    margin-left: -10px;
    white-space: wrap;
    display: inline-block;
}
</style>
</head>
<body>
<div class="content">
<div class="arabic">ÿßŸÑŸÇÿ±ÿ¢ŸÜ</div>  <!-- Arap√ßa Kur'an -->
<h1>Kur'an</h1><br>
<div class="topbar"><center>
    <button onclick="window.location.href='/'" class="nav-btn">‚Üê</button>
<select id="sureSelect"><option value="">T√ºm Kur'an</option></select>
<input type="text" id="searchInput" placeholder="Ayet veya i√ßerik ara...">

<!-- Yazdƒ±rma Butonu -->
<button id="printBtn" class="nav-btn">Yazdƒ±r</button>
</center></div><br><br>

<div id="ayetler"><div class="loading">Y√ºkleniyor...</div></div>

<div id="navigationButtons" style="text-align:center; margin-top:20px; display:none;">
  <button id="prevSure" class="nav-btn">‚Üê √ñnceki Sure</button>
  <button id="nextSure" class="nav-btn">Sonraki Sure ‚Üí</button>
</div>
</div>

<script src="./print.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
const sureSelect = document.getElementById('sureSelect');
const searchInput = document.getElementById('searchInput');
let allVerses = []; 

const sureNames=[ /* ... liste aynƒ± ≈üekilde burada ... */ 
"Fatiha","Bakara","Al-i ƒ∞mran","Nisa","Maide","En'am","A'raf","Enfal","Tevbe","Yunus","Hud","Yusuf","Rad","ƒ∞brahim",
"Hicr","Nahl","ƒ∞sra","Kehf","Meryem","Taha","Enbiya","Hac","M√ºminun","Nur","Furkan","≈ûuara","Neml","Kasas","Ankebut","Rum",
"Lukman","Secde","Ahzab","Sebe","Fatƒ±r","Yasin","Saffat","Sad","Z√ºmer","M√ºmin","Fussilet","≈ûura","Zuhruf","Duhan","Casiye","Ahkaf",
"Muhammed","Fetih","Hucurat","Kaf","Zariyat","Tur","Necm","Kamer","Rahman","Vakƒ±a","Hadid","M√ºcadele","Ha≈ür","M√ºmtehine","Saf",
"Cuma","M√ºnafikun","Tegabun","Talak","Tahrim","M√ºlk","Kalem","Hakka","Mearic","Nuh","Cin","M√ºzzemmil","M√ºddessir","Kƒ±yamet","ƒ∞nsan","M√ºrselat",
"Nebe","Naziat","Abese","Tekvir","ƒ∞nfitar","Mutaffifin","ƒ∞n≈üikak","B√ºruc","Tarƒ±k","A'la","Ga≈üiye","Fecr","Beled","Leyl","Duha",
"ƒ∞n≈üirah","Tin","Tarƒ±k","Alak","Kadir","Beyyine","Zilzal","Adiyat","Kari'a","Tekas√ºr","Asr","H√ºmeze","Fil","Kurey≈ü","Ma'un","Kevser","Kafirun","Nasr","Tebbet","ƒ∞hlas","Felak","Nas"
];

// Dropdown olu≈ütur
for(let i=1;i<=114;i++){
    const option=document.createElement('option');
    option.value=i;
    option.textContent=`${i}. ${sureNames[i-1] || 'Sure '+i}`;
    sureSelect.appendChild(option);
}

// Butonlar
const prevSureBtn = document.getElementById('prevSure');
const nextSureBtn = document.getElementById('nextSure');
const navigationDiv = document.getElementById('navigationButtons');

// Yazdƒ±rma butonu
const printBtn = document.getElementById('printBtn');
printBtn.addEventListener('click', () => {
    const pdfPath = `./pdf/${sureSelect.value}.pdf`;

    printJS(pdfPath);
});

function updateNavigationButtons(chapter){
    if(!chapter) { navigationDiv.style.display='none'; return; }
    navigationDiv.style.display='block';
    prevSureBtn.disabled = (chapter <= 1);
    nextSureBtn.disabled = (chapter >= 114);
}

prevSureBtn.addEventListener('click',()=>{
    let chap = parseInt(sureSelect.value);
    if(chap > 1){ chap--; sureSelect.value = chap; loadVerse(chap); localStorage.setItem('lastChapter', chap); }
});

nextSureBtn.addEventListener('click',()=>{
    let chap = parseInt(sureSelect.value);
    if(chap < 114){ chap++; sureSelect.value = chap; loadVerse(chap); localStorage.setItem('lastChapter', chap); }
});

// JSON y√ºkleme
async function loadVerse(chapter){
    const container=document.getElementById('ayetler');
    container.innerHTML='<div class="loading">Y√ºkleniyor...</div>';
    allVerses=[];
    if(!chapter) return loadAllVerses(); 
    try{
        const response=await fetch(`/data/verses/${chapter}.json`);
        const data=await response.json();
        allVerses=data.verses;
        renderVerses(allVerses);
        updateNavigationButtons(parseInt(chapter));
        const scrollTop = localStorage.getItem(`${sureSelect.value}.scrollTop`);
        if(scrollTop) window.scrollTo(0, parseInt(scrollTop));
    }catch(e){
        container.innerHTML='<div class="loading">Bu sure y√ºklenemedi.</div>'; 
        console.error(e);
        navigationDiv.style.display='none';
    }
}

// T√ºm Kur'an
async function loadAllVerses(){
    const container=document.getElementById('ayetler');
    container.innerHTML='<div class="loading">Y√ºkleniyor...</div>';
    allVerses=[];
    for(let i=1;i<=114;i++){
        try{
            const response=await fetch(`/data/verses/${i}.json`);
            const data=await response.json();
            allVerses.push(...data.verses);
        }catch(e){console.error(`Sure ${i} y√ºklenemedi`,e);}
    }
    renderVerses(allVerses);
    navigationDiv.style.display='none';
    const scrollTop = localStorage.getItem(`${sureSelect.value}.scrollTop`);
    if(scrollTop) window.scrollTo(0, parseInt(scrollTop));
}

function renderVerses(verses, highlight=''){
    const container = document.getElementById('ayetler');
    container.innerHTML = '';

    function randomColor() {
        // Beyazƒ± tamamen √ßƒ±karƒ±yoruz
        const colors = ['#ff6b6b', '#fbc531', '#4cd137', '#00a8ff', '#9c88ff', '#ff9ff3', '#ff4757', '#ff793f', '#3742fa'];
        return colors[Math.floor(Math.random() * colors.length)];
    }

    verses.forEach(ayet => {
        const verseDiv = document.createElement('div');
        verseDiv.classList.add('verse');

        const number = document.createElement('div');
        number.classList.add('verse-number');
        number.textContent = `Ayet ${ayet.verseNumber} (${ayet.verseKey})`;

        const arabic = document.createElement('div');
        arabic.classList.add('arabic-text');
        arabic.innerHTML = highlightText(ayet.arabic, highlight);

        const english = document.createElement('div');
        english.classList.add('english-text');
        english.innerHTML = highlightText(ayet.english, highlight);

        const shareBtn = document.createElement('button');
        shareBtn.textContent = 'üì§ Payla≈ü';
        shareBtn.classList.add('nav-btn');
        shareBtn.style.fontSize = '16px';
        shareBtn.style.padding = '6px 12px';
        shareBtn.style.marginTop = '5px';

        shareBtn.addEventListener('click', async () => {
            const width = 1080;
            const height = 1080;
            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');

            // Rastgele gradient arka plan (beyaz yok)
            const gradient = ctx.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, randomColor());
            gradient.addColorStop(0.5, randomColor());
            gradient.addColorStop(1, randomColor());
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);

            // Soft glow radial patlamalar
            for(let i=0;i<4;i++){
                const radius = Math.random()*400 + 200;
                const x = Math.random()*width;
                const y = Math.random()*height;
                const glow = ctx.createRadialGradient(x, y, 0, x, y, radius);
                glow.addColorStop(0,'rgba(255,255,255,0.08)');
                glow.addColorStop(1,'rgba(255,255,255,0)');
                ctx.fillStyle = glow;
                ctx.fillRect(0,0,width,height);
            }

            // Hafif geometrik desen
            for(let i=0;i<150;i++){
                ctx.fillStyle = `rgba(255,255,255,${Math.random()*0.05})`;
                const x = Math.random()*width;
                const y = Math.random()*height;
                const r = Math.random()*3+1;
                ctx.beginPath();
                ctx.arc(x,y,r,0,2*Math.PI);
                ctx.fill();
            }

            // Ayeti ortala
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = '#ffffff'; // Beyaz metin

            // Arap√ßa ayet
            ctx.font = 'bold 80px Aqeeq, serif';
            ctx.shadowColor = 'rgba(0,0,0,0.3)';
            ctx.shadowBlur = 10;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;

            const arabicLines = ayet.arabic.split(/\n/);
            const arabicLineHeight = 90;
            let arabicHeight = arabicLines.length * arabicLineHeight;
            let y = (height - arabicHeight) / 2 - 50;

            arabicLines.forEach(line => {
                ctx.fillText(line, width/2, y);
                y += arabicLineHeight;
            });

            // ƒ∞ngilizce √ßeviri + ayet numarasƒ±
            ctx.shadowColor = 'transparent';
            ctx.fillStyle = '#ffffff';
            ctx.font = '36px Arial, sans-serif';

            const englishText = ayet.english + ` [${ayet.verseKey}]`;
            const words = englishText.split(' ');
            const maxWidth = width - 100;
            const lineHeight = 44;
            let line = '';
            let englishLines = [];

            words.forEach((word, idx) => {
                const testLine = line + (line ? ' ' : '') + word;
                const metrics = ctx.measureText(testLine);
                if(metrics.width > maxWidth){
                    englishLines.push(line);
                    line = word;
                } else {
                    line = testLine;
                }
                if(idx === words.length - 1) englishLines.push(line);
            });

            y += 20;
            englishLines.forEach(el => {
                ctx.fillText(el, width/2, y);
                y += lineHeight;
            });

            // Alt site adƒ± - beyaz
            ctx.font = '24px Arial, sans-serif';
            ctx.fillStyle = '#ffffff';
            ctx.fillText('kuran.yasireymen.com', width/2, height - 40);

            // G√∂rseli payla≈ü
            canvas.toBlob(blob => {
                const filesArray = [new File([blob], 'ayet.png', {type: 'image/png'})];
                if (navigator.canShare && navigator.canShare({files: filesArray})) {
                    navigator.share({
                        files: filesArray,
                        title: 'Ayet Payla≈üƒ±mƒ±',
                        text: ayet.english
                    }).catch(err => console.error('Payla≈üƒ±m hatasƒ±:', err));
                } else {
                    alert('Bu cihaz resim payla≈üƒ±mƒ±nƒ± desteklemiyor.');
                }
            });
        });

        verseDiv.appendChild(number);
        verseDiv.appendChild(arabic);
        verseDiv.appendChild(english);
        verseDiv.appendChild(shareBtn);

        container.appendChild(verseDiv);
    });
}




function highlightText(text, query){
    if(!query) return text;
    const escaped=query.replace(/[-/\\^$*+?.()|[\]{}]/g,'\\$&');
    const regex=new RegExp(escaped,'gi');
    return text.replace(regex,match=>`<mark>${match}</mark>`);
}

sureSelect.addEventListener('change',(e)=>{
    const chapter=e.target.value;
    searchInput.value='';
    loadVerse(chapter);
    localStorage.setItem('lastChapter', chapter);
    window.location.href = "/kuran"
});

// Arama
searchInput.addEventListener('input',(e)=>{
    const query=e.target.value.toLowerCase();
    if(!query) return renderVerses(allVerses);
    const filtered=allVerses.filter(ayet=>
        ayet.arabic.toLowerCase().includes(query) ||
        ayet.english.toLowerCase().includes(query) ||
        ayet.verseNumber.toString().includes(query)
    );
    renderVerses(filtered,query);
});

// Scroll pozisyonu kaydet
window.addEventListener('beforeunload',()=>{
    localStorage.setItem(`${sureSelect.value}.scrollTop`, window.scrollY);
});

// Kaldƒ±ƒüƒ± yerden devam
const lastChapter = localStorage.getItem('lastChapter');
if(lastChapter){
    sureSelect.value = lastChapter;
    loadVerse(lastChapter);
}else{
    loadAllVerses();
}

// URL parametresinden sure kontrol√º
function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

const urlSure = getQueryParam('sure');
if (urlSure && !isNaN(urlSure) && urlSure >= 1 && urlSure <= 114) {
    sureSelect.value = urlSure;
    loadVerse(urlSure);
} else {
    // Kaldƒ±ƒüƒ± yerden devam veya t√ºm Kur'an
    const lastChapter = localStorage.getItem('lastChapter');
    if(lastChapter){
        sureSelect.value = lastChapter;
        loadVerse(lastChapter);
    } else {
        loadAllVerses();
    }
}

</script>
</body>
</html>
