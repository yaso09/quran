<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kur'an Okuyucu</title>
<style>
@font-face {
    font-family: 'Aqeeq';
    src: url('/Aqeeq-Bold.ttf') format('truetype');
    font-weight: 700;
    font-style: normal;
    font-display: swap;
}
@font-face {
    font-family: 'StackSansNotch';
    src: url('/StackSansNotch-Bold.ttf') format('truetype');
    font-weight: 700;
    font-style: normal;
    font-display: swap;
}
body {
    margin: 0;
    font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Noto Sans', sans-serif;
    background: #fff;
    color: #000;
    line-height: 1.5;
}
.content {
    max-width: 1000px;
    margin: auto;
    padding: 20px;
}
h1, h2 { font-family: 'StackSansNotch', sans-serif; text-align: center; }
.controls { margin-bottom: 20px; text-align: center; }
.controls select, .controls input { font-size: 16px; padding: 6px 12px; margin: 5px; }
.verse { margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.arabic-text {
    font-family: 'Aqeeq', 'Noto Naskh Arabic', serif;
    font-size: 32px;
    font-weight: 700;
    margin: 5px 0;
    text-align: right;
}
.english-text { font-size: 16px; margin-bottom: 10px; text-align: left; }
.verse-number { font-size: 12px; font-weight: bold; color: #555; margin-bottom: 5px; text-align: center; }
.loading { font-size: 18px; font-weight: bold; text-align: center; margin: 30px 0; }
mark { background-color: yellow; }
@media(max-width:800px){.arabic-text{font-size:25px;}.english-text{font-size:14px;}.controls select,.controls input{font-size:14px;}}
</style>
</head>
<body>
<div class="content">
<h1>Kur'an Okuyucu</h1>
<div class="controls">
<select id="sureSelect"><option value="">Tüm Kur'an</option></select>
<input type="text" id="searchInput" placeholder="Ayet veya içerik ara...">
</div>
<div id="ayetler"><div class="loading">Yükleniyor...</div></div>
</div>
<script>
const sureSelect = document.getElementById('sureSelect');
const searchInput = document.getElementById('searchInput');
let allVerses = []; 

// Tüm sure isimleri
const sureNames=[
"Fatiha","Bakara","Al-i İmran","Nisa","Maide","En'am","A'raf","Enfal","Tevbe","Yunus","Hud","Yusuf","Rad","İbrahim",
"Hicr","Nahl","İsra","Kehf","Meryem","Taha","Enbiya","Hac","Müminun","Nur","Furkan","Şuara","Neml","Kasas","Ankebut","Rum",
"Lukman","Secde","Ahzab","Sebe","Fatır","Yasin","Saffat","Sad","Zümer","Mümin","Fussilet","Şura","Zuhruf","Duhan","Casiye","Ahkaf",
"Muhammed","Fetih","Hucurat","Kaf","Zariyat","Tur","Necm","Kamer","Rahman","Vakıa","Hadid","Mücadele","Haşr","Mümtehine","Saf",
"Cuma","Münafikun","Tegabun","Talak","Tahrim","Mülk","Kalem","Hakka","Mearic","Nuh","Cin","Müzzemmil","Müddessir","Kıyamet","İnsan","Mürselat",
"Nebe","Naziat","Abese","Tekvir","İnfitar","Mutaffifin","İnşikak","Büruc","Tarık","A'la","Gaşiye","Fecr","Beled","Leyl","Duha",
"İnşirah","Tin","Alak","Kadir","Beyyine","Zilzal","Adiyat","Kari'a","Tekasür", "Asr", "Hümeze", "Fil", "Kureyş", "Ma'un", "Kevser", "Kafirun", "Nasr", "Tebbet", "İhlas", "Felak", "Nas"
];

// Dropdown oluştur
for(let i=1;i<=114;i++){
    const option=document.createElement('option');
    option.value=i;
    option.textContent=`${i}. ${sureNames[i-1] || 'Sure '+i}`;
    sureSelect.appendChild(option);
}

// JSON dosyasından sure yükle
async function loadVerse(chapter){
    const container=document.getElementById('ayetler');
    container.innerHTML='<div class="loading">Yükleniyor...</div>';
    allVerses=[];
    if(!chapter) return loadAllVerses(); // Tüm Kur'an
    try{
        const response=await fetch(`/data/verses/${chapter}.json`);
        const data=await response.json();
        allVerses=data.verses;
        renderVerses(allVerses);
        // Scroll pozisyonunu geri yükle
        const scrollTop = localStorage.getItem('scrollTop');
        if(scrollTop) window.scrollTo(0, parseInt(scrollTop));
    }catch(e){container.innerHTML='<div class="loading">Bu sure yüklenemedi.</div>'; console.error(e);}
}

// Tüm Kur'an'ı yükle
async function loadAllVerses(){
    const container=document.getElementById('ayetler');
    container.innerHTML='<div class="loading">Yükleniyor...</div>';
    allVerses=[];
    for(let i=1;i<=114;i++){
        try{
            const response=await fetch(`/data/verses/${i}.json`);
            const data=await response.json();
            allVerses.push(...data.verses);
        }catch(e){console.error(`Sure ${i} yüklenemedi`,e);}
    }
    renderVerses(allVerses);
    // Scroll pozisyonunu geri yükle
    const scrollTop = localStorage.getItem('scrollTop');
    if(scrollTop) window.scrollTo(0, parseInt(scrollTop));
}

// Ayetleri render et
function renderVerses(verses, highlight=''){
    const container=document.getElementById('ayetler');
    container.innerHTML='';
    verses.forEach(ayet=>{
        const verseDiv=document.createElement('div');
        const number=document.createElement('div');
        number.classList.add('verse-number');
        number.textContent=`Ayet ${ayet.verseNumber} (${ayet.verseKey})`;
        const arabic=document.createElement('div');
        arabic.classList.add('arabic-text');
        arabic.innerHTML=highlightText(ayet.arabic,highlight);
        const english=document.createElement('div');
        english.classList.add('english-text');
        english.innerHTML=highlightText(ayet.english,highlight);
        verseDiv.classList.add('verse');
        verseDiv.appendChild(number);
        verseDiv.appendChild(arabic);
        verseDiv.appendChild(english);
        container.appendChild(verseDiv);
    });
}

// Metni highlight et
function highlightText(text, query){
    if(!query) return text;
    const escaped=query.replace(/[-/\\^$*+?.()|[\]{}]/g,'\\$&');
    const regex=new RegExp(escaped,'gi');
    return text.replace(regex,match=>`<mark>${match}</mark>`);
}

// Dropdown değişince
sureSelect.addEventListener('change',(e)=>{
    const chapter=e.target.value;
    searchInput.value='';
    loadVerse(chapter);
    localStorage.setItem('lastChapter', chapter);
});

// Arama
searchInput.addEventListener('input',(e)=>{
    const query=e.target.value.toLowerCase();
    if(!query) return renderVerses(allVerses);
    const filtered=allVerses.filter(ayet=>
        ayet.arabic.toLowerCase().includes(query) ||
        ayet.english.toLowerCase().includes(query) ||
        ayet.verseNumber.toString().includes(query)
    );
    renderVerses(filtered,query);
});

// Scroll pozisyonu kaydet
window.addEventListener('beforeunload',()=>{
    localStorage.setItem('scrollTop', window.scrollY);
});

// Sayfa açıldığında kaldığı yerden devam et
const lastChapter = localStorage.getItem('lastChapter');
if(lastChapter){
    sureSelect.value = lastChapter;
    loadVerse(lastChapter);
}else{
    loadAllVerses();
}
</script>
</body>
</html>
